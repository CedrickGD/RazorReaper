name: Discord Release Notification

on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord notification
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          # Use event data directly - it's reliable
          TAG_NAME="${{ github.event.release.tag_name }}"
          RELEASE_NAME="${{ github.event.release.name }}"
          RELEASE_URL="${{ github.event.release.html_url }}"
          
          # Escape any quotes in the name for JSON
          SAFE_NAME=$(echo "$RELEASE_NAME" | sed 's/"/\\"/g')
          
          echo "Sending Discord notification for: $TAG_NAME"
          
          curl -X POST "$DISCORD_WEBHOOK_URL" \
               -H "Content-Type: application/json" \
               -d "{
                 \"embeds\": [{
                   \"title\": \"ðŸš€ New Release: $TAG_NAME\",
                   \"description\": \"**$SAFE_NAME**\",
                   \"url\": \"$RELEASE_URL\",
                   \"color\": 3066993,
                   \"fields\": [
                     {
                       \"name\": \"Version\",
                       \"value\": \"$TAG_NAME\",
                       \"inline\": true
                     },
                     {
                       \"name\": \"Repository\",
                       \"value\": \"${{ github.repository }}\",
                       \"inline\": true
                     }
                   ]
                 }]
               }"
